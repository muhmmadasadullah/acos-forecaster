<!--
  ACoS Forecaster static site (v1.0)

  This standalone HTML file implements the Amazon PPC ACoS forecasting tool using
  React and Recharts. All dependencies are pulled from public CDNs, so no
  bundler is required. The app lets users enter current advertising metrics and
  experiment with new CPC (cost per click) and CVR (conversion rate) values
  to see how those changes impact ACoS, estimated spend, orders and sales. A
  sensitivity chart illustrates how varying CVR values change ACoS at a fixed
  CPC.

  To host this file on GitHub Pages under a sub‑path (e.g. /acos‑forecaster/1.0/),
  simply place it at that directory within your repository. For example,
  committing this file as `1.0/index.html` in the `acos‑forecaster` repository
  will make it available at:

    https://USERNAME.github.io/acos-forecaster/1.0/

  Replace USERNAME with your GitHub username. No additional build steps are
  necessary.
-->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ACoS Forecaster</title>
    <!-- Tailwind CSS via CDN for styling. Using a CDN avoids the need for a build step. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM UMD builds -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Recharts removed: we implement charts in pure SVG so there is no external
         dependency for charting. Removing this script eliminates the risk of
         network issues preventing the charts from loading. -->
    <!-- Basic styling for cards and KPI badges -->
    <style>
      /* Accent gradient used in the header badge */
      .accent {
        background: linear-gradient(135deg, #1428A0, #00B5F1);
      }
    </style>
  </head>
  <body class="bg-white text-neutral-900">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useMemo } = React;
      // We intentionally avoid external chart libraries in this static build. Charts
      // are rendered using a lightweight custom SVG component (SimpleLineChart)
      // defined below. This eliminates reliance on Recharts loading from a CDN.

      /**
       * Card component renders a titled section with optional subtitle.
       */
      function Card({ title, subtitle, children }) {
        return (
          <div className="rounded-2xl border border-neutral-100 bg-white shadow-sm p-5">
            <h3 className="text-lg font-semibold flex items-center gap-2">
              {/* Blue dot to mimic a subtle icon */}
              <span className="h-4 w-4 rounded-full bg-blue-600"></span>
              {title}
            </h3>
            {subtitle && (
              <p className="mt-1 text-sm text-neutral-500">{subtitle}</p>
            )}
            <div className="mt-4">{children}</div>
          </div>
        );
      }

      /**
       * Simple input field with label. All input fields in the app use this
       * component. Values are controlled by parent state via the onChange
       * callback.
       */
      function InputField({ label, value, onChange }) {
        return (
          <label className="block mb-3">
            <span className="block text-sm text-neutral-600 mb-1">{label}</span>
            <input
              className="w-full rounded-xl border border-neutral-200 px-3 py-2"
              value={value}
              onChange={(e) => onChange(e.target.value)}
            />
          </label>
        );
      }

      /**
       * Component for the two forecast input fields (CPC and CVR). Separated
       * into its own component for clarity. These fields accept string values
       * because the surrounding app handles conversion to numbers.
       */
      function TargetInputs({ newCpc, setNewCpc, newCvrPct, setNewCvrPct }) {
        return (
          <>
            <h4 className="text-sm font-medium mb-3 flex items-center gap-2">
              {/* Another subtle dot for the section */}
              <span className="h-3 w-3 rounded-full bg-blue-500"></span>
              Forecast Inputs
            </h4>
            <InputField
              label="New CPC ($)"
              value={newCpc}
              onChange={setNewCpc}
            />
            <InputField
              label="New CVR (%)"
              value={newCvrPct}
              onChange={setNewCvrPct}
            />
          </>
        );
      }

      /**
       * Row showing a single metric label/value pair. An optional 'big'
       * boolean toggles a larger font size for the value (used for New ACoS).
       */
      function MetricRow({ label, value, big = false }) {
        return (
          <div className="flex items-center justify-between py-2.5">
            <span className="text-sm text-neutral-600">{label}</span>
            <span
              className={`px-2.5 py-1 font-medium rounded-lg bg-red-50 text-red-600 ${big ? 'text-base' : 'text-sm'}`}
            >
              {value}
            </span>
          </div>
        );
      }

      /**
       * Mini KPI card used in the Forecast section to show estimated spend,
       * orders, sales, ROAS, CPA, and profit.
       */
      function MiniKPI({ label, value }) {
        return (
          <div className="rounded-xl border border-neutral-100 bg-neutral-50 px-3 py-2">
            <div className="text-[11px] uppercase tracking-wide text-neutral-500">
              {label}
            </div>
            <div className="text-sm font-semibold">{value}</div>
          </div>
        );
      }

      /**
       * SimpleLineChart renders a basic line chart using SVG. It takes an array
       * of data points with 'name' and numeric 'acosPct' properties along with
       * the current ACoS value (0–1). By avoiding an external charting
       * dependency, this component ensures the chart always displays even when
       * the network is slow or blocked. The chart scales responsively to the
       * parent container's width while maintaining a fixed height.
       */
      function SimpleLineChart({ data, currentAcos }) {
        /*
         * A responsive line chart drawn in pure SVG. The chart reserves
         * margins for axis labels so that text doesn’t overlap the plot.
         * Coordinates are normalised to a 0–1 range; margins carve out
         * space on the left and bottom. The y‑domain spans the data and
         * current reference value. Axis ticks are computed dynamically.
         */
        const heightPx = 220; // fixed pixel height; width is driven by container
        // Margins expressed as fractions of the total width/height
        const leftMargin = 0.12;
        const rightMargin = 0.03;
        const bottomMargin = 0.18;
        const topMargin = 0.05;
        // Build y-domain using all data points and the current reference
        const ys = data.map((p) => p.acosPct);
        const refVal = (currentAcos || 0) * 100;
        let yMin = Math.min(...ys, refVal);
        let yMax = Math.max(...ys, refVal);
        if (yMin === yMax) {
          yMin = yMin - 1;
          yMax = yMax + 1;
        }
        const yRange = yMax - yMin;
        // Map a data index to x (0–1) taking margins into account
        const xForIndex = (i) =>
          leftMargin + (i / (data.length - 1)) * (1 - leftMargin - rightMargin);
        // Map a y value to normalised coordinate (0 at top, 1 at bottom) within the chart area
        const yForValue = (val) =>
          topMargin + (1 - (val - yMin) / yRange) * (1 - topMargin - bottomMargin);
        // Construct polyline path string
        const pointsStr = data
          .map((p, i) => `${xForIndex(i)},${yForValue(p.acosPct)}`)
          .join(' ');
        // Reference line position
        const refY = yForValue(refVal);
        // Generate y ticks (5 ticks including min/max)
        const yTicks = [];
        const tickCount = 4;
        for (let i = 0; i <= tickCount; i++) {
          const value = yMax - (yRange * i) / tickCount;
          const y = topMargin + (i / tickCount) * (1 - topMargin - bottomMargin);
          yTicks.push({ y, value });
        }
        return (
          <svg
            viewBox="0 0 1 1"
            preserveAspectRatio="none"
            className="w-full"
            style={{ height: `${heightPx}px` }}
          >
            {/* Horizontal grid lines and y‑axis labels */}
            {yTicks.map((tick, idx) => (
              <g key={idx}>
                <line
                  x1={leftMargin}
                  y1={tick.y}
                  x2={1 - rightMargin}
                  y2={tick.y}
                  stroke="#e5e7eb"
                  strokeWidth="0.0025"
                />
                <text
                  x={leftMargin - 0.02}
                  y={tick.y + 0.01}
                  fontSize="0.028"
                  fill="#6b7280"
                  textAnchor="end"
                >
                  {tick.value.toFixed(0)}%
                </text>
              </g>
            ))}
            {/* Reference line for current ACoS */}
            <line
              x1={leftMargin}
              y1={refY}
              x2={1 - rightMargin}
              y2={refY}
              stroke="#ff4d4f"
              strokeWidth="0.003"
              strokeDasharray="0.01 0.01"
            />
            {/* Data line */}
            <polyline
              fill="none"
              stroke="#0066cc"
              strokeWidth="0.0045"
              points={pointsStr}
            />
            {/* X‑axis labels */}
            {data.map((p, i) => (
              <text
                key={i}
                x={xForIndex(i)}
                y={1 - bottomMargin + 0.05}
                fontSize="0.028"
                fill="#6b7280"
                textAnchor="middle"
              >
                {p.name}
              </text>
            ))}
          </svg>
        );
      }

      /**
       * Top level application component. Contains all state and logic for the
       * forecasting model along with the UI layout. State values are stored
       * as strings to preserve the exact input text; conversions to numeric
       * values happen via helper functions when performing calculations.
       */
      function App() {
        // Input state: current advertising metrics
        const [adSpend, setAdSpend] = useState('300');
        const [adSales, setAdSales] = useState('1000');
        const [adClicks, setAdClicks] = useState('500');
        const [adOrders, setAdOrders] = useState('50');
        // Forecast input state: new CPC and CVR
        const [newCpc, setNewCpc] = useState('0.60');
        const [newCvrPct, setNewCvrPct] = useState('12');

        // Helpers to safely convert strings to numbers. toNum removes
        // thousands separators and returns 0 for invalid input. safeDiv
        // prevents divide‑by‑zero errors.
        const toNum = (v) => {
          const n = parseFloat((v ?? '').toString().replace(/,/g, ''));
          return isNaN(n) ? 0 : n;
        };
        const safeDiv = (num, den) => (den > 0 ? num / den : 0);

        // Compute current metrics based on input fields. useMemo ensures
        // calculations only run when dependencies change. ACoS, CPC,
        // conversion rate and average order value (AOV) are derived here.
        const current = useMemo(() => {
          const spend = toNum(adSpend);
          const sales = toNum(adSales);
          const clicks = toNum(adClicks);
          const orders = toNum(adOrders);
          return {
            spend,
            sales,
            clicks,
            orders,
            acos: safeDiv(spend, sales),
            cpc: safeDiv(spend, clicks),
            cvr: safeDiv(orders, clicks),
            aov: safeDiv(sales, orders),
          };
        }, [adSpend, adSales, adClicks, adOrders]);

        // Forecast metrics computed from the new CPC and CVR values. The
        // existing click volume is used for the forecast to simulate only
        // efficiency changes (not volume changes). The delta shows the
        // difference between forecast ACoS and current ACoS.
        const forecast = useMemo(() => {
          const cpc = toNum(newCpc);
          const cvr = toNum(newCvrPct) / 100;
          const clicks = current.clicks;
          const estOrders = clicks * cvr;
          const estSpend = clicks * cpc;
          const estSales = estOrders * (current.aov || 0);
          const newAcos = safeDiv(estSpend, estSales);
          const delta = newAcos - current.acos;
          return {
            cpc,
            cvr,
            clicks,
            estOrders,
            estSpend,
            estSales,
            newAcos,
            delta,
          };
        }, [newCpc, newCvrPct, current]);

        // Generate chart data for ACoS vs CVR. The CPC used is the
        // forecasted new CPC. For each CVR from 2% to 30% in 2% increments we
        // compute the resulting ACoS. Multiplying by 100 yields a percentage.
        const chartData = useMemo(() => {
          const points = [];
          const clicks = Math.max(1, current.clicks || 0);
          const aov = current.aov || 0;
          const cpc = toNum(newCpc);
          for (let pct = 2; pct <= 30; pct += 2) {
            const cvr = pct / 100;
            const orders = clicks * cvr;
            const spend = clicks * cpc;
            const sales = orders * aov;
            const acos = safeDiv(spend, sales) * 100;
            points.push({ name: `${pct}%`, acosPct: isFinite(acos) ? acos : 0 });
          }
          return points;
        }, [current.clicks, current.aov, newCpc]);

        // Format helper functions for display
        const fmtPct = (v) => `${(v * 100).toFixed(2)}%`;
        const fmtMoney = (v) => `$${v.toFixed(2)}`;
        const fmtUnit = (v) => `${Math.round(v)}`;

        return (
          <div className="min-h-screen flex flex-col">
            {/* Header with logo and title */}
            <header className="sticky top-0 z-20 bg-white/80 backdrop-blur border-b border-neutral-100">
              <div className="mx-auto max-w-6xl px-4 py-4 flex items-center justify-center">
                <div className="flex items-center gap-3">
                  <div className="h-10 w-10 rounded-xl accent"></div>
                  <h1 className="text-2xl font-bold tracking-tight">
                    ACoS Forecaster
                  </h1>
                </div>
              </div>
            </header>

            {/* Main content grid */}
            <main className="flex-1 mx-auto max-w-6xl px-4 py-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Inputs */}
              <section className="lg:col-span-1">
                <Card
                  title="Inputs"
                  subtitle="Enter your current ad metrics and forecast inputs"
                >
                  <InputField
                    label="Ad Spend ($)"
                    value={adSpend}
                    onChange={setAdSpend}
                  />
                  <InputField
                    label="Ad Sales ($)"
                    value={adSales}
                    onChange={setAdSales}
                  />
                  <InputField
                    label="Ad Clicks"
                    value={adClicks}
                    onChange={setAdClicks}
                  />
                  <InputField
                    label="Ad Orders"
                    value={adOrders}
                    onChange={setAdOrders}
                  />
                  <TargetInputs
                    newCpc={newCpc}
                    setNewCpc={setNewCpc}
                    newCvrPct={newCvrPct}
                    setNewCvrPct={setNewCvrPct}
                  />
                </Card>
              </section>

              {/* Current metrics */}
              <section className="lg:col-span-1">
                <Card title="Current Metrics" subtitle="Calculated from inputs">
                  <MetricRow label="ACoS" value={fmtPct(current.acos)} />
                  <MetricRow label="Avg CPC" value={fmtMoney(current.cpc)} />
                  <MetricRow label="Ad CVR" value={fmtPct(current.cvr)} />
                  <MetricRow label="Ad AOV" value={fmtMoney(current.aov)} />
                </Card>
              </section>

              {/* Forecast */}
              <section className="lg:col-span-1">
                <Card title="Forecast" subtitle="Impact from New CPC & CVR">
                  <MetricRow
                    label="New ACoS"
                    value={fmtPct(forecast.newAcos)}
                    big
                  />
                  <p className="text-sm mt-2">
                    Change: {(forecast.delta * 100).toFixed(2)}% — negative is
                    improvement (lower ACoS).
                  </p>
                  <div className="mt-4 grid grid-cols-3 gap-3 text-sm">
                    <MiniKPI label="Est. Spend" value={fmtMoney(forecast.estSpend)} />
                    <MiniKPI label="Est. Orders" value={fmtUnit(forecast.estOrders)} />
                    <MiniKPI label="Est. Sales" value={fmtMoney(forecast.estSales)} />
                  </div>
                  <div className="mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200 text-xs text-neutral-700 leading-relaxed">
                    <strong>Detailed logic:</strong>
                    <ul className="list-disc pl-5 mt-1 space-y-1">
                      <li>Current clicks remain constant</li>
                      <li>Est. Spend = Clicks × New CPC</li>
                      <li>Est. Orders = Clicks × New CVR</li>
                      <li>Est. Sales = Est. Orders × Current AOV</li>
                      <li>New ACoS = Est. Spend ÷ Est. Sales</li>
                    </ul>
                  </div>
                </Card>
              </section>

              {/* Sensitivity chart removed as requested. */}
            </main>

            {/* Footer */}
            <footer className="border-t border-neutral-100 py-6">
              <div className="mx-auto max-w-6xl text-center">
                <p className="font-medium text-neutral-900">
                  Made by Asadullah. Connect on{' '}
                  <a
                    href="https://www.linkedin.com/in/muhamadasadullah/"
                    target="_blank"
                    className="text-blue-600 hover:underline"
                    >
                    LinkedIn
                  </a>
                </p>
              </div>
            </footer>
          </div>
        );
      }

      // Render the app into the #root element
      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
